## 아이템 7 - 다 쓴 객체 참조를 해제하라 - 완벽 공략
---
### NullPointerException

우리가 코딩을 하다보면 __NullPointerException__ 을 만나는 경우가 종종 발생한다.

```java
public class MemberShip {
   public String hello() {
      return "hello";
   }
}
```
__MemberShip__ 클래스를 작성한다.

```java
public class Channel {

   private int numOfSubscribers;

   public Optional<MemberShip> defaultMemberShip() {
      if (this.numOfSubscribers < 2000) {
         return null;
      } else {
         return new MemberShip();
      }
   }
}
```

__Channel__ 클래스를 작성한다.

위의 경우에는 메서드가 null 을 리턴하는 경우가 있다.

```java
class ChannelTest {
   @Test
   void npe() {
      Channel channel = new Channel();
      MemberShip memberShip = channel.defaultMemberShip();
      
      memberShip.hello(); // NullPointerException 발생
   }
}
```

__Channel__ 클래스 사용하는 곳에서 null 값을 체크하지 않는다면 NullPointerException 발생할 수도 있다.


```java
class ChannelTest {
   @Test
   void npe() {
      Channel channel = new Channel();
      MemberShip memberShip = channel.defaultMemberShip();
      
      if (memberShip != null) {
         memberShip.hello(); 
      }
   }
}
```

위처럼 null을 체크하여 null이 아닌 경우에만 로직을 실행하도록 코드를 작성하면 된다.

NullPointerException 을 줄이면서 코딩을 할 수 있게끔 api 를 제공하면 좋을 것이다.

api를 만드는 입장에서 생각해보면 

- 예외를 던진다.
- null 을 리턴한다.

이렇게 2가지가 있을 것이다.

자바 8에서는 __Optional__ 이 추가되었다.

```java
public class Channel {

   private int numOfSubscribers;

   public Optional<MemberShip> defaultMemberShip() {
      if (this.numOfSubscribers < 2000) {
         return Optional.empty();
      } else {
         return Optional.of(new MemberShip());
      }
   }
}
```

리턴타입이 null 일 수도 있는 경우에는 __Optional__ 로 리턴하는게 좋다.

```java
class ChannelTest {
   @Test
   void npe() {
      Channel channel = new Channel();
      Optional<MemberShip> optional = channel.defaultMemberShip();
      optional.ifPresent(MemberShip::hello);
   }
}
```

비어있을 수도 있는 객체를 __Optional__ 로 리턴하면 사용하는 쪽에서는 

__Optional__ 로 객체를 받아 사용하게 된다.

__Optional__ 에서 객체를 꺼내야 객체를 사용할 수 있게된다.

이렇게 api 를 제공할 때 __Optional__ 을 사용하면 클라이언트에서 발생하는 NullPointerException 을 줄일 수 있다.

```java
class ChannelTest {
   @Test
   void npe() {
      Channel channel = new Channel();
      Optional<MemberShip> optional = channel.defaultMemberShip();
      optional.get().hello();
   }
}
```

다만 __Optional__ 을 확인하지 않고 객체를 꺼내 사용하면 다른 에러를 만나게 된다.

__Optional__ 을 사용할때는 __Optional__ 에서 제공하는 메서드를 활용해 사용하는게 좋다.

주의할 점으로는

1. __Optional__ 은 __Return__ 타입으로 사용하기 위해 만든 것이기 때문에 다른 곳에서 사용하는 걸 권장하지 않는다.

매개변수 타입으로 __Optional__ 을 사용하는 건 권장하지 않는다.

2. __Optional__ 로 Collection 을 감싸면 안된다.

List, Set 자체가 그 안이 비어있는지 아닌지에 대한 메서드를 가지고 있다.

때문에 굳이 __Collection__ 을 __Optional__ 로 감쌀 필요가 없다.

3.  __Optional__ 을 리턴하는 메서드에서는  __Optional__ 을 리턴하도록하자. 즉, null 을 리턴하지 않도록 한다.

4. 프리미티브 타입을 __Optional__ 로 감싸야한다면 __OptionalInt__, __OptionalLong__ 등을 사용한다.

---




